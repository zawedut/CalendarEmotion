<style>
@import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Mitr:wght@400;500;600&display=swap');

:root{
  --bg: #FFE5F1;
  --card: #ffffff;
  --accent: #E85D9A;
  --text: #2D2D2D;
  --muted: #888;
  --btn-bg: #FFB3D9;
  
  /* ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå */
  --mood-angry: url('https://nonglearndee.com/wp-content/uploads/2025/11/‡πÇ‡∏Å‡∏£‡∏ò-removebg-preview.png');
  --mood-sad: url('https://nonglearndee.com/wp-content/uploads/2025/11/‡πÄ‡∏®‡∏£‡πâ‡∏≤-removebg-preview.png');
  --mood-bored: url('https://nonglearndee.com/wp-content/uploads/2025/11/‡πÄ‡∏ö‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏≤‡∏¢-removebg-preview.png');
  --mood-wink: url('https://nonglearndee.com/wp-content/uploads/2025/11/‡∏Ç‡∏¢‡∏¥‡∏ö‡∏ï‡∏≤-removebg-preview.png');
  --mood-happy: url('https://nonglearndee.com/wp-content/uploads/2025/11/‡∏î‡∏µ‡πÉ‡∏à_‡πÄ‡πÄ‡∏Æ‡∏õ‡∏õ‡∏µ‡πâ-removebg-preview.png');
}

/* ‡∏ò‡∏µ‡∏°‡∏™‡∏µ */
.season-spring { --bg:#FFE1ED; --accent:#E85D9A; --btn-bg:#FFB3D9; }
.season-summer { --bg:#FFE8D1; --accent:#E8854D; --btn-bg:#FFD4AD; }
.season-autumn { --bg:#FFDDD1; --accent:#E8754D; --btn-bg:#FFC4AD; }
.season-winter { --bg:#D9EDFF; --accent:#5DA8E8; --btn-bg:#B3D9FF; }

* {
  -webkit-tap-highlight-color: transparent;
  box-sizing: border-box;
}

@keyframes slideIn {
  from { transform: translateY(10px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

@keyframes popIn {
    0% { transform: scale(0.5); opacity: 0; }
    80% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); }
}

@keyframes labelPop {
    0% { transform: translateY(10px) scale(0.8); opacity: 0; }
    50% { transform: translateY(-5px) scale(1.05); opacity: 1; }
    100% { transform: translateY(0) scale(1); opacity: 1; }
}

.calendar-wrap{
  display:flex;
  justify-content:center;
  padding: 20px 10px;
  font-family:'Mitr', 'Fredoka', sans-serif;
  width: 100%;
}

.calendar{
  width: 100%;
  max-width: 420px;
  background: var(--bg);
  border-radius: 28px;
  padding: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
  position: relative;
  transition: background-color 0.3s ease;
}

/* Header Controls */
.controls{
  display:flex;
  justify-content: space-between;
  align-items:center;
  margin-bottom: 20px;
}

.ctrl-btn{
  border: none;
  background: white;
  width: 46px;
  height: 40px;
  border-radius: 12px;
  cursor:pointer;
  color: var(--accent);
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  transition: all 0.2s ease;
  font-size: 18px;
  font-family:'Mitr', sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ctrl-btn:active {
  transform: scale(0.9);
  background: var(--accent);
  color: white;
}

.month-year{
  font-size: 20px;
  font-weight: 600;
  color: var(--text);
  flex: 1;
  text-align: center;
}

.calendar-title {
  text-align:center;
  color: var(--accent);
  margin: 0 0 15px 0;
  font-size: 24px;
  font-weight: 600;
  letter-spacing: 0.5px;
}

/* Grid Layout */
.calendar-grid{
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  margin-top: 10px;
  width: 100%;
}

.weekday{
  text-align:center;
  font-size: 13px;
  color: var(--muted);
  font-weight: 500;
  margin-bottom: 5px;
}

/* Date Cell Styling */
.cell{
  background: var(--card);
  border-radius: 16px;
  aspect-ratio: 1 / 1.4; 
  width: 100%; 
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
  user-select: none;
  overflow: hidden;
  padding: 6px 4px;
}

/* Hover Effect - ‡∏™‡∏µ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•‡∏ï‡∏≤‡∏°‡∏§‡∏î‡∏π‡∏Å‡∏≤‡∏• */
.season-spring .cell:active, 
.season-spring .cell:hover {
  transform: translateY(-2px);
  border-color: #E85D9A;
  background-color: #FFD6E8;
  box-shadow: 0 4px 12px rgba(232, 93, 154, 0.3);
  z-index: 2;
}

.season-summer .cell:active, 
.season-summer .cell:hover {
  transform: translateY(-2px);
  border-color: #E8854D;
  background-color: #FFE0C4;
  box-shadow: 0 4px 12px rgba(232, 133, 77, 0.3);
  z-index: 2;
}

.season-autumn .cell:active, 
.season-autumn .cell:hover {
  transform: translateY(-2px);
  border-color: #E8754D;
  background-color: #FFD4C4;
  box-shadow: 0 4px 12px rgba(232, 117, 77, 0.3);
  z-index: 2;
}

.season-winter .cell:active, 
.season-winter .cell:hover {
  transform: translateY(-2px);
  border-color: #5DA8E8;
  background-color: #D0E8FF;
  box-shadow: 0 4px 12px rgba(93, 168, 232, 0.3);
  z-index: 2;
}

.cell.faded{
  opacity: 0.35;
  pointer-events: all;
}

.cell.faded .cell-number {
  color: #bbb;
  font-size: 13px;
}

/* ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà */
.cell-number {
  font-size: 13px;
  font-weight: 600;
  color: var(--text);
  line-height: 1;
  transition: all 0.3s ease;
  margin-bottom: 2px;
}

/* Emoji Container inside Cell */
.emoji-display{
  width: 0;
  height: 0;
  opacity: 0;
  background-size: 100%;
  background-position: center;
  background-repeat: no-repeat;
  margin-top: 0;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  flex-shrink: 0;
}

/* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå */
.cell.has-mood {
  justify-content: flex-start;
  padding: 6px 4px;
}

.cell.has-mood .emoji-display {
  width: 100%;
  height: calc(100% - 18px);
  opacity: 1;
  margin-top: 4px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.12));
}

.cell.has-mood .cell-number {
  font-size: 11px;
  color: var(--muted);
  font-weight: 500;
}

/* Mapping ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û + ‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå */
.emoji-display[data-mood="5"] { 
  background-image: var(--mood-happy); 
}
.cell.has-mood[data-mood="5"] {
  background: linear-gradient(135deg, #E8F8E8 0%, #C8F0C8 100%);
  border-color: #66D966;
}

.emoji-display[data-mood="4"] { 
  background-image: var(--mood-wink); 
}
.cell.has-mood[data-mood="4"] {
  background: linear-gradient(135deg, #E8F4FD 0%, #D0E7F9 100%);
  border-color: #6BA3D4;
}

.emoji-display[data-mood="3"] { 
  background-image: var(--mood-bored); 
}
.cell.has-mood[data-mood="3"] {
  background: linear-gradient(135deg, #FFF8E1 0%, #FFECB3 100%);
  border-color: #FFC04D;
}

.emoji-display[data-mood="2"] { 
  background-image: var(--mood-sad); 
}
.cell.has-mood[data-mood="2"] {
  background: linear-gradient(135deg, #FFECD9 0%, #FFD4A8 100%);
  border-color: #FFB366;
}

.emoji-display[data-mood="1"] { 
  background-image: var(--mood-angry); 
}
.cell.has-mood[data-mood="1"] {
  background: linear-gradient(135deg, #FFE5E5 0%, #FFD0D0 100%);
  border-color: #FF6B6B;
}

/* Today Highlight */
.cell.today {
  border: 2px solid var(--accent);
  color: var(--accent);
  background: #fff;
}

/* Modal Popup */
.mood-modal{
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.4);
  z-index: 10000;
  backdrop-filter: blur(4px);
  animation: fadeIn 0.2s ease;
}

.mood-modal.active { display: flex; }

.modal-card{
  width: 88%;
  max-width: 400px;
  background: #ffffff;
  padding: 25px;
  border-radius: 30px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.2);
  text-align: center;
  animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.modal-card h3 {
  margin: 0 0 20px 0;
  font-size: 20px;
  color: var(--text);
}

.modal-row{
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

/* Mood Selection Buttons */
.mood-btn-wrapper {
  position: relative;
  display: inline-block;
}

.mood-btn{
  border: 3px solid transparent;
  background-color: #F8F8F8;
  border-radius: 18px;
  width: 60px;
  height: 60px;
  cursor: pointer;
  position: relative;
  background-size: 65%;
  background-position: center;
  background-repeat: no-repeat;
  transition: all 0.2s ease;
}

.mood-btn[data-score="5"] { 
  background-image: var(--mood-happy);
  background-color: #E8F8E8;
}
.mood-btn[data-score="4"] { 
  background-image: var(--mood-wink);
  background-color: #E8F4FD;
}
.mood-btn[data-score="3"] { 
  background-image: var(--mood-bored);
  background-color: #FFF8E1;
}
.mood-btn[data-score="2"] { 
  background-image: var(--mood-sad);
  background-color: #FFECD9;
}
.mood-btn[data-score="1"] { 
  background-image: var(--mood-angry);
  background-color: #FFE5E5;
}

.mood-btn:active { transform: scale(0.95); }

.mood-btn.selected[data-score="5"]{
  background-color: #C8F0C8;
  border-color: #66D966;
  box-shadow: 0 8px 20px rgba(102, 217, 102, 0.3);
  transform: translateY(-5px);
}

.mood-btn.selected[data-score="4"]{
  background-color: #D0E7F9;
  border-color: #6BA3D4;
  box-shadow: 0 8px 20px rgba(107, 163, 212, 0.3);
  transform: translateY(-5px);
}

.mood-btn.selected[data-score="3"]{
  background-color: #FFECB3;
  border-color: #FFC04D;
  box-shadow: 0 8px 20px rgba(255, 192, 77, 0.3);
  transform: translateY(-5px);
}

.mood-btn.selected[data-score="2"]{
  background-color: #FFD4A8;
  border-color: #FFB366;
  box-shadow: 0 8px 20px rgba(255, 179, 102, 0.3);
  transform: translateY(-5px);
}

.mood-btn.selected[data-score="1"]{
  background-color: #FFD0D0;
  border-color: #FF6B6B;
  box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
  transform: translateY(-5px);
}

/* Label Popup */
.mood-label {
  position: absolute;
  top: -35px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.85);
  color: white;
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease;
  z-index: 100;
  font-family: 'Mitr', sans-serif;
}

.mood-btn-wrapper:active .mood-label,
.mood-btn-wrapper:hover .mood-label {
  opacity: 1;
  animation: labelPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Comment Box */
textarea.comment{
  width: 100%;
  padding: 15px;
  border-radius: 18px;
  border: 1px solid #eee;
  background: #F9F9F9;
  font-family: 'Mitr', sans-serif;
  font-size: 14px;
  resize: none;
  height: 80px;
  outline: none;
}

textarea.comment:focus {
  border-color: var(--accent);
  background: #fff;
}

/* Actions */
.modal-actions{
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.action-btn {
  flex: 1;
  padding: 12px;
  border-radius: 15px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  font-family: 'Mitr', sans-serif;
}

.btn-save {
  background: var(--accent);
  color: white;
  box-shadow: 0 4px 10px rgba(232, 93, 154, 0.3);
}

.btn-cancel {
  background: #f0f0f0;
  color: #666;
}

/* Responsive */
@media (min-width: 480px) {
    .calendar-grid { gap: 12px; }
    .cell { aspect-ratio: 1 / 1.35; }
    .cell.has-mood .cell-number { font-size: 12px; }
    .cell-number { font-size: 14px; }
    .mood-btn { width: 70px; height: 70px; }
}
</style>

<div class="calendar-wrap">
  <div class="calendar" id="moodCalendar">
    <h3 class="calendar-title">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</h3>
    
    <div class="controls">
      <button class="ctrl-btn" id="prevMonth">‚ùÆ</button>
      <div class="month-year" id="monthYear"></div>
      <button class="ctrl-btn" id="nextMonth">‚ùØ</button>
    </div>

    <div class="calendar-grid" id="calendarGrid"></div>
  </div>
</div>

<div class="mood-modal" id="moodModal">
  <div class="modal-card" id="modalCard">
    <h3>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏á?</h3>

    <div class="modal-row" id="moodButtons">
      <div class="mood-btn-wrapper">
        <button class="mood-btn" data-score="5"></button>
        <div class="mood-label">üòÑ ‡∏î‡∏µ‡πÉ‡∏à</div>
      </div>
      <div class="mood-btn-wrapper">
        <button class="mood-btn" data-score="4"></button>
        <div class="mood-label">üòâ ‡∏Ç‡∏¢‡∏¥‡∏ö‡∏ï‡∏≤</div>
      </div>
      <div class="mood-btn-wrapper">
        <button class="mood-btn" data-score="3"></button>
        <div class="mood-label">üòê ‡πÄ‡∏ö‡∏∑‡πà‡∏≠</div>
      </div>
      <div class="mood-btn-wrapper">
        <button class="mood-btn" data-score="2"></button>
        <div class="mood-label">üò¢ ‡πÄ‡∏®‡∏£‡πâ‡∏≤</div>
      </div>
      <div class="mood-btn-wrapper">
        <button class="mood-btn" data-score="1"></button>
        <div class="mood-label">üò° ‡πÇ‡∏Å‡∏£‡∏ò</div>
      </div>
    </div>

    <textarea class="comment" id="moodComment" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏±‡πâ‡∏ô‡πÜ..."></textarea>

    <div class="modal-actions">
      <button class="action-btn btn-save" id="saveMood">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      <button class="action-btn btn-cancel" id="closeModal">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>
</div>

<script>
(function(){
  const monthNames = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

  const grid = document.getElementById('calendarGrid');
  const monthYear = document.getElementById('monthYear');
  const prev = document.getElementById('prevMonth');
  const next = document.getElementById('nextMonth');
  const modal = document.getElementById('moodModal');
  const modalCard = document.getElementById('modalCard');
  const commentEl = document.getElementById('moodComment');
  const moodButtons = document.getElementById('moodButtons');
  const saveBtn = document.getElementById('saveMood');
  const closeBtn = document.getElementById('closeModal');
  const calendarEl = document.getElementById('moodCalendar');

  let view = new Date();
  let selectedKey = null;
  const keyName = "mood_calendar_v2";

  function load(){ try { return JSON.parse(localStorage.getItem(keyName) || "{}"); } catch(e) { return {}; } }
  function save(obj){ try { localStorage.setItem(keyName, JSON.stringify(obj)); } catch(e) {} }

  function season(month){
    if(month>=2 && month<=4) return "season-spring";
    if(month>=5 && month<=7) return "season-summer";
    if(month>=8 && month<=10) return "season-autumn";
    return "season-winter";
  }

  function render(){
    const currentSeason = season(view.getMonth());
    calendarEl.className = "calendar " + currentSeason;
    
    monthYear.textContent = monthNames[view.getMonth()] + " " + (view.getFullYear() + 543);
    grid.innerHTML = '';

    const weekdays = ['‡∏≠‡∏≤','‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™'];
    weekdays.forEach(day => {
        const d = document.createElement("div");
        d.className = "weekday";
        d.textContent = day;
        grid.appendChild(d);
    });

    const entries = load();
    const year = view.getFullYear();
    const month = view.getMonth();
    const startDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();
    
    // ‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    const prevMonthDays = new Date(year, month, 0).getDate();

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    for(let i=startDay-1; i>=0; i--){
      const day = prevMonthDays - i;
      const cell = document.createElement("div");
      cell.className="cell faded";
      
      const prevMonth = month === 0 ? 11 : month - 1;
      const prevYear = month === 0 ? year - 1 : year;
      const key = `${prevYear}-${String(prevMonth+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

      const number = document.createElement("div");
      number.className = "cell-number";
      number.textContent = day;

      const em = document.createElement("div");
      em.className = "emoji-display";

      if(entries[key]) {
        em.setAttribute('data-mood', entries[key].score);
        cell.setAttribute('data-mood', entries[key].score);
        cell.classList.add('has-mood');
      }

      cell.appendChild(number);
      cell.appendChild(em);
      cell.addEventListener("click", ()=> openModal(key));
      grid.appendChild(cell);
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    for(let day=1; day<=daysInMonth; day++){
      const cell = document.createElement("div");
      cell.className="cell";
      const key = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

      const number = document.createElement("div");
      number.className = "cell-number";
      number.textContent = day;

      const em = document.createElement("div");
      em.className = "emoji-display";

      if(entries[key]) {
        em.setAttribute('data-mood', entries[key].score);
        cell.setAttribute('data-mood', entries[key].score);
        cell.classList.add('has-mood');
      }

      cell.appendChild(number);
      cell.appendChild(em);
      cell.addEventListener("click", ()=> openModal(key));
      grid.appendChild(cell);

      const today = new Date();
      if(today.getFullYear()==year && today.getMonth()==month && today.getDate()==day)
        cell.classList.add("today");
    }
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
    const totalCells = grid.children.length - 7; // ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    const remainingCells = 42 - totalCells; // 6 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå x 7 ‡∏ß‡∏±‡∏ô
    
    for(let day=1; day<=remainingCells; day++){
      const cell = document.createElement("div");
      cell.className="cell faded";
      
      const nextMonth = month === 11 ? 0 : month + 1;
      const nextYear = month === 11 ? year + 1 : year;
      const key = `${nextYear}-${String(nextMonth+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

      const number = document.createElement("div");
      number.className = "cell-number";
      number.textContent = day;

      const em = document.createElement("div");
      em.className = "emoji-display";

      if(entries[key]) {
        em.setAttribute('data-mood', entries[key].score);
        cell.setAttribute('data-mood', entries[key].score);
        cell.classList.add('has-mood');
      }

      cell.appendChild(number);
      cell.appendChild(em);
      cell.addEventListener("click", ()=> openModal(key));
      grid.appendChild(cell);
    }
  }

  function openModal(key){
    selectedKey = key;
    const entries = load();
    const entry = entries[key] || {};
    commentEl.value = entry.comment || "";

    const allBtns = moodButtons.querySelectorAll('.mood-btn');
    allBtns.forEach(btn=>{
      const score = btn.dataset.score;
      btn.classList.toggle("selected", String(score) === String(entry.score));
    });

    modal.classList.add("active");
  }

  function close(){
    modal.classList.remove("active");
    selectedKey = null;
    const allBtns = moodButtons.querySelectorAll('.mood-btn');
    allBtns.forEach(btn=> btn.classList.remove("selected"));
  }

  moodButtons.addEventListener("click",(e)=>{
    const btn = e.target.closest('.mood-btn'); 
    if(btn){
      const allBtns = moodButtons.querySelectorAll('.mood-btn');
      allBtns.forEach(b=> b.classList.remove("selected"));
      btn.classList.add("selected");
    }
  });

  saveBtn.addEventListener("click",()=>{
    const entries = load();
    const moodBtn = moodButtons.querySelector('.mood-btn.selected');
    
    if (moodBtn) {
        entries[selectedKey] = {
            score: Number(moodBtn.dataset.score),
            comment: commentEl.value.trim(),
            updated: Date.now()
        };
        save(entries);
    }
    close();
    render();
  });

  closeBtn.addEventListener("click", close);
  modal.addEventListener("click", (e)=> { if(e.target === modal) close(); });

  prev.addEventListener("click",()=>{ view = new Date(view.getFullYear(), view.getMonth()-1, 1); render(); });
  next.addEventListener("click",()=>{ view = new Date(view.getFullYear(), view.getMonth()+1, 1); render(); });

  render();
})();
</script>