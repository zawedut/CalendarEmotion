<style>
@import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Mitr:wght@300;400;500;600&display=swap');

:root{
  --glass: rgba(255, 255, 255, 0.75);
  --glass-border: rgba(255, 255, 255, 0.6);
  --shadow-premium: 0 15px 35px rgba(0,0,0,0.05), 0 5px 15px rgba(0,0,0,0.03);
  --text-main: #4A4A4A;
  --text-light: #888888;
}

/* ธีมสีแบบ Gradient ไล่เฉดให้ดูแพง */
.season-spring { 
  --bg-gradient: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%);
  --accent: #FF85B3; 
  --btn-grad: linear-gradient(to right, #FF9A9E 0%, #FECFEF 100%);
  --today-glow: rgba(255, 133, 179, 0.4);
}
.season-summer { 
  --bg-gradient: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
  --accent: #FF8C61; 
  --btn-grad: linear-gradient(to right, #FFECD2 0%, #FCB69F 100%);
  --today-glow: rgba(255, 140, 97, 0.4);
}
.season-autumn { 
  --bg-gradient: linear-gradient(to top, #fff1eb 0%, #ace0f9 100%); /* Cool autumn breeze */
  --accent: #78A8D1; 
  --btn-grad: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
  --today-glow: rgba(120, 168, 209, 0.4);
}
.season-winter { 
  --bg-gradient: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
  --accent: #9B72CF; 
  --btn-grad: linear-gradient(to right, #c1dfc4 0%, #deecdd 100%); 
  /* Fallback winter gradient fix */
  --btn-grad: linear-gradient(to right, #E0C3FC 0%, #8EC5FC 100%);
  --today-glow: rgba(155, 114, 207, 0.4);
}

.calendar-wrap { 
  display:flex; 
  justify-content:center; 
  padding: 40px 20px; 
  font-family:'Mitr', sans-serif;
  background: var(--bg-gradient); /* พื้นหลัง Gradient อยู่นอกสุด */
  min-height: 500px;
  border-radius: 30px;
  background-size: 200% 200%;
  animation: gradientBG 15s ease infinite;
}

@keyframes gradientBG {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.calendar {
  width: 450px;
  max-width: 100%;
  background: var(--glass);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 2px solid var(--glass-border);
  border-radius: 32px;
  padding: 30px;
  box-shadow: var(--shadow-premium);
  position: relative;
  overflow: hidden;
  transition: all 0.5s ease;
}

/* Header Section */
.calendar-title {
  text-align:center;
  color: var(--text-main);
  margin: 0 0 25px 0;
  font-size: 24px;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.calendar-title span {
  color: var(--accent);
}

.controls {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom: 25px;
  padding: 0 10px;
}

.ctrl-btn {
  border: none;
  background: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor:pointer;
  color: var(--accent);
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  font-size: 16px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.ctrl-btn:hover {
  transform: scale(1.15);
  background: var(--accent);
  color: white;
  box-shadow: 0 8px 20px var(--today-glow);
}

.month-year {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-main);
  font-family: 'Fredoka', sans-serif;
}

/* Grid System */
.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 12px;
}

.weekday {
  text-align:center;
  font-size:13px;
  color: var(--text-light);
  font-weight:500;
  margin-bottom: 5px;
}

/* Day Cells */
.cell {
  background: rgba(255,255,255,0.6);
  border-radius: 18px;
  aspect-ratio: 1/1.1;
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  align-items: center;
  padding-top: 8px;
  cursor:pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-family: 'Fredoka', sans-serif;
  font-weight: 500;
  color: var(--text-main);
  border: 1px solid transparent;
  position: relative;
}

.cell:hover {
  background: white;
  transform: translateY(-4px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
  border-color: var(--accent);
}

.cell.faded { opacity: 0.3; pointer-events:none; background:none; }

/* Today Highlight */
.cell.today {
  background: white;
  border: 2px solid var(--accent);
  color: var(--accent);
  box-shadow: 0 0 15px var(--today-glow);
}

.cell.today::after {
  content:'';
  position:absolute;
  top: 6px;
  right: 6px;
  width:6px;
  height:6px;
  background:var(--accent);
  border-radius:50%;
}

/* Mood Image inside cell */
.mood-image-cell {
  width: 32px;
  height: 32px;
  object-fit: contain;
  margin-top: 4px;
  filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
  transition: transform 0.3s ease;
}

.cell:hover .mood-image-cell {
  transform: scale(1.2) rotate(8deg);
}

/* Modal Styling (Glassmorphism) */
.mood-modal {
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background: rgba(45, 45, 45, 0.4);
  backdrop-filter: blur(5px);
  z-index:9999;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.mood-modal.active { display:flex; opacity:1; }

.modal-card {
  width:90%;
  max-width:420px;
  background: rgba(255, 255, 255, 0.95);
  padding: 35px;
  border-radius: 30px;
  box-shadow: 0 25px 50px rgba(0,0,0,0.2);
  transform: scale(0.9);
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  text-align: center;
}

.mood-modal.active .modal-card { transform: scale(1); }

.modal-card h3 {
  margin: 0 0 20px 0;
  color: var(--text-main);
  font-family: 'Mitr', sans-serif;
  font-size: 22px;
}

.modal-row {
  display:flex;
  justify-content: center;
  gap: 15px;
  margin-bottom: 25px;
}

.mood-btn {
  width: 60px;
  height: 60px;
  border-radius: 20px;
  border: 2px solid transparent;
  background: #F4F6F8;
  cursor:pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.mood-btn img { width: 35px; height: 35px; object-fit: contain; }

.mood-btn:hover { transform: scale(1.1); background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

.mood-btn.selected {
  background: #fff;
  border-color: var(--accent);
  box-shadow: 0 8px 20px var(--today-glow);
  transform: scale(1.15);
}

textarea.comment {
  width:100%;
  border: 2px solid #EEE;
  border-radius: 18px;
  padding: 15px;
  font-family: 'Mitr', sans-serif;
  transition: 0.3s;
  background: #FAFAFA;
}

textarea.comment:focus {
  outline:none;
  border-color: var(--accent);
  background: white;
}

/* Premium Buttons */
.modal-actions {
  display:flex;
  gap: 15px;
  margin-top: 25px;
}

.action-btn {
  flex: 1;
  padding: 12px;
  border:none;
  border-radius: 15px;
  font-family: 'Mitr', sans-serif;
  font-weight: 500;
  cursor: pointer;
  transition: transform 0.2s;
  font-size: 15px;
}

.btn-save {
  background: var(--btn-grad);
  color: white; /* เปลี่ยนเป็นสีขาวให้ตัดกับ gradient */
  color: #444; /* หรือสีเข้มถ้า gradient สว่างมาก */
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.btn-cancel {
  background: transparent;
  color: #999;
}

.btn-save:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
.btn-cancel:hover { color: #555; background: #f0f0f0; }

</style>

<div class="calendar-wrap season-spring" id="mainWrap">
  <div class="calendar" id="moodCalendar">
    <h3 class="calendar-title">Mood <span>Calendar</span></h3>
    
    <div class="controls">
      <button class="ctrl-btn" id="prevMonth">❮</button>
      <div class="month-year" id="monthYear"></div>
      <button class="ctrl-btn" id="nextMonth">❯</button>
    </div>

    <div class="calendar-grid" id="calendarGrid">
      <div class="weekday">SUN</div>
      <div class="weekday">MON</div>
      <div class="weekday">TUE</div>
      <div class="weekday">WED</div>
      <div class="weekday">THU</div>
      <div class="weekday">FRI</div>
      <div class="weekday">SAT</div>
    </div>
  </div>
</div>

<div class="mood-modal" id="moodModal">
  <div class="modal-card">
    <h3>วันนี้รู้สึกยังไงบ้าง?</h3>

    <div class="modal-row" id="moodButtons">
       <button class="mood-btn" data-score="5">
        <img src="https://cdn-icons-png.flaticon.com/512/187/187133.png" alt="Happy++">
      </button>
      <button class="mood-btn" data-score="4">
        <img src="https://cdn-icons-png.flaticon.com/512/187/187142.png" alt="Happy">
      </button>
      <button class="mood-btn" data-score="3">
        <img src="https://cdn-icons-png.flaticon.com/512/187/187148.png" alt="Normal">
      </button>
      <button class="mood-btn" data-score="2">
        <img src="https://cdn-icons-png.flaticon.com/512/187/187153.png" alt="Sad">
      </button>
      <button class="mood-btn" data-score="1">
        <img src="https://cdn-icons-png.flaticon.com/512/187/187150.png" alt="Angry">
      </button>
    </div>

    <textarea class="comment" id="moodComment" placeholder="บันทึกเรื่องราวสั้นๆ..."></textarea>

    <div class="modal-actions">
      <button class="action-btn btn-cancel" id="closeModal">ยกเลิก</button>
      <button class="action-btn btn-save" id="saveMood">บันทึกความรู้สึก</button>
    </div>
  </div>
</div>

<script>
(function(){
  // *** CONFIG: URL รูปภาพ (ผมใส่ Demo ไว้ให้ก่อน ถ้ามีรูปเองให้แก้ตรงนี้) ***
  const moodImages = {
    1: 'https://cdn-icons-png.flaticon.com/512/187/187150.png',
    2: 'https://cdn-icons-png.flaticon.com/512/187/187153.png',
    3: 'https://cdn-icons-png.flaticon.com/512/187/187148.png',
    4: 'https://cdn-icons-png.flaticon.com/512/187/187142.png',
    5: 'https://cdn-icons-png.flaticon.com/512/187/187133.png'
  };

  const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];

  const grid = document.getElementById('calendarGrid');
  const monthYear = document.getElementById('monthYear');
  const prev = document.getElementById('prevMonth');
  const next = document.getElementById('nextMonth');
  const modal = document.getElementById('moodModal');
  const commentEl = document.getElementById('moodComment');
  const moodButtons = document.getElementById('moodButtons');
  const saveBtn = document.getElementById('saveMood');
  const closeBtn = document.getElementById('closeModal');
  const mainWrap = document.getElementById('mainWrap');

  let view = new Date();
  let selectedKey = null;
  const keyName = "mood_calendar_premium_v1";

  function load(){ 
    try { return JSON.parse(localStorage.getItem(keyName) || "{}"); } catch(e) { return {}; }
  }
  
  function save(obj){ 
    localStorage.setItem(keyName, JSON.stringify(obj));
  }

  function getSeasonClass(month){
    if(month>=2 && month<=4) return "season-spring";
    if(month>=5 && month<=7) return "season-summer";
    if(month>=8 && month<=10) return "season-autumn";
    return "season-winter";
  }

  function render(){
    const currentMonth = view.getMonth();
    const seasonClass = getSeasonClass(currentMonth);
    
    // Reset classes
    mainWrap.className = "calendar-wrap " + seasonClass;

    monthYear.textContent = monthNames[currentMonth] + " " + view.getFullYear();

    // Clear grid (keep headers)
    while(grid.children.length > 7) grid.removeChild(grid.lastChild);

    const entries = load();
    const year = view.getFullYear();
    const month = view.getMonth();
    const first = new Date(year, month, 1);
    const startDay = first.getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();

    // Empty cells before first day
    for(let i=0;i<startDay;i++){
      const d = document.createElement("div");
      d.className="cell faded";
      grid.appendChild(d);
    }

    for(let day=1; day<=daysInMonth; day++){
      const cell = document.createElement("div");
      cell.className="cell";
      const key = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

      const num = document.createElement("span");
      num.textContent = day;
      num.style.zIndex = "2";
      cell.appendChild(num);

      if(entries[key] && entries[key].score) {
        const img = document.createElement("img");
        img.className = "mood-image-cell";
        img.src = moodImages[entries[key].score];
        cell.appendChild(img);
        // Add subtle indicator dot if commented
        if(entries[key].comment){
           const dot = document.createElement('div');
           dot.style.cssText = "width:4px;height:4px;background:var(--accent);border-radius:50%;position:absolute;bottom:5px;";
           cell.appendChild(dot);
        }
      }

      cell.addEventListener("click", ()=> openModal(key));
      grid.appendChild(cell);

      const today = new Date();
      if(today.getFullYear()==year && today.getMonth()==month && today.getDate()==day)
        cell.classList.add("today");
    }
  }

  function openModal(key){
    selectedKey = key;
    const entries = load();
    const entry = entries[key] || {};
    commentEl.value = entry.comment || "";

    [...moodButtons.children].forEach(btn=>{
      btn.classList.toggle("selected", String(btn.dataset.score)===String(entry.score));
    });
    modal.classList.add("active");
  }

  function close(){
    modal.classList.remove("active");
    selectedKey = null;
    commentEl.value="";
    [...moodButtons.children].forEach(btn=> btn.classList.remove("selected"));
  }

  moodButtons.addEventListener("click",(e)=>{
    const btn = e.target.closest(".mood-btn");
    if(btn){
      [...moodButtons.children].forEach(b=> b.classList.remove("selected"));
      btn.classList.add("selected");
    }
  });

  saveBtn.addEventListener("click",()=>{
    if(!selectedKey) return;
    const entries = load();
    const moodBtn = [...moodButtons.children].find(b=> b.classList.contains("selected"));
    
    // Delete entry if nothing selected and empty comment, otherwise save
    if(!moodBtn && !commentEl.value.trim()){
        delete entries[selectedKey];
    } else {
        entries[selectedKey] = {
        score: moodBtn ? Number(moodBtn.dataset.score) : null,
        comment: commentEl.value.trim(),
        updated: Date.now()
        };
    }
    
    save(entries);
    close();
    render();
  });

  closeBtn.addEventListener("click", close);
  modal.addEventListener("click", (e)=> { if(e.target === modal) close(); });

  prev.addEventListener("click",()=>{ view = new Date(view.getFullYear(), view.getMonth()-1, 1); render(); });
  next.addEventListener("click",()=>{ view = new Date(view.getFullYear(), view.getMonth()+1, 1); render(); });

  render();
})();
</script>